!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).GlobeMap={})}(this,function(e){"use strict";var t={Scene2D:0,Scene3D:1};function i(e){this.map=e}function n(e,n){this.control=null,this.container=e,this.camera=new i(n);var a=this;this.camera.map.on("postMapRender",function(){null!=a.control&&a.control.isAutoSwitch&&a.control.sceneMode==t.Scene2D&&a.update()}),this.update()}function a(e){this.map=e}function o(e){this.viewer=e}function s(e,t){this.control=null,this.container=e,this.camera=new o(t);var i=this;this.viewerHandler=new Cesium.ScreenSpaceEventHandler(this.camera.viewer.scene.canvas),this.viewerHandler.setInputAction(function(e){i.update()},Cesium.ScreenSpaceEventType.WHEEL),this.camera.viewer.scene.camera.changed.addEventListener(function(){i.update()}),this.camera.viewer.scene.postRender.addEventListener(function(){i.update()}),this.update()}function r(e){this.viewer=e}function c(e,i){this.scene2D=e,this.scene2D.control=this,this.scene3D=i,this.scene3D.control=this,this.isAutoSwitch=!0,this.switchZoom=4,this.sceneMode=t.Scene3D}i.prototype={toDegrees:function(e){return e*(180/Math.PI)},toRadians:function(e){return e*(Math.PI/180)},computeZoom:function(){return this.map.getZoom()},computeParam:function(){var e={};return e.pitch=this.map.getPitch(),e.heading=this.map.getBearing(),e.zoom=this.map.getZoom(),e.center=this.map.getCenter(),e.longitude=e.center.lng,e.latitude=e.center.lat,e},switchTo:function(e){var t=e.pitch,i=e.heading,n=e.zoom,a={center:[e.longitude,e.latitude],zoom:n,bearing:-this.toDegrees(i),pitch:this.toDegrees(t)};this.map.jumpTo(a),this.map.render()}},n.prototype={update:function(){null!=this.control&&this.control.isAutoSwitch&&this.control.sceneMode==t.Scene2D&&(this.camera.computeZoom()<this.control.switchZoom&&this.control.switchTo(t.Scene3D))},show:function(e){this.getElement(this.container).style.visibility=e?"visible":"hidden"},getElement:function(e){if("string"==typeof e){var t=document.getElementById(e);if(null===t)throw new Error;e=t}return e}},a.prototype={toDegrees:function(e){return e*(180/Math.PI)},toRadians:function(e){return e*(Math.PI/180)},computeZoom:function(){return this.map.getZoom()},computeParam:function(){var e={};return e.pitch=this.map.getPitch(),e.heading=this.map.getBearing(),e.zoom=this.map.getZoom(),e.center=this.map.getCenter(),e.longitude=e.center.lng,e.latitude=e.center.lat,e},switchTo:function(e){var t=e.pitch,i=e.heading,n=e.zoom,a={center:[e.longitude,e.latitude],zoom:n,bearing:-this.toDegrees(i),pitch:this.toDegrees(t)};this.map.jumpTo(a),this.map.render()}},o.prototype={toDegrees:function(e){return e*(180/Math.PI)},toRadians:function(e){return e*(Math.PI/180)},computeZoom:function(){return this.computeParam().zoom},computeParam:function(){var e={},t=this.viewer.scene,i=t.camera,n=Cesium.Ellipsoid.WGS84,a=this.pickCenterPoint(t);if(!a){var o=i.positionCartographic.clone();o.height=t.globe.getHeight(o)||0,a=Cesium.Ellipsoid.WGS84.cartographicToCartesian(o)}e.carto=Cesium.Ellipsoid.WGS84.cartesianToCartographic(a),e.longitude=this.toDegrees(e.carto.longitude),e.latitude=this.toDegrees(e.carto.latitude);var s=Cesium.Cartesian3.distance(a,i.position);e.resolution=this.computeResolutionForDistance(t,1,s,this.toRadians(e.latitude));var r=40075016.68557849/e.resolution/512;if(e.zoom=Math.log(r)/Math.LN2,a){var c=i.position,h=new Cesium.Cartesian3;n.geocentricSurfaceNormal(a,h);var u=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(c,a,u),Cesium.Cartesian3.normalize(u,u);var m=i.up,l=i.right,p=new Cesium.Cartesian3(-a.y,a.x,0);e.heading=Cesium.Cartesian3.angleBetween(l,p);var d=Cesium.Cartesian3.cross(a,m,new Cesium.Cartesian3).z;e.heading=d<0?e.heading:-e.heading;var g=Math.acos(Cesium.Cartesian3.dot(h,u));e.pitch=isNaN(g)?0:g}else e.heading=i.heading,e.pitch=-i.pitch+Math.PI/2;return e},switchTo:function(e){var t=e.pitch,i=e.heading,n=e.zoom,a=e.longitude,o=e.latitude,s=this.viewer.scene,r=s.camera,c=(Cesium.Ellipsoid.WGS84,new Cesium.Cartographic(this.toRadians(a),this.toRadians(o)));if(s.globe){var h=s.globe.getHeight(c);c.height=h||0}var u=Cesium.Ellipsoid.WGS84.cartographicToCartesian(c),m={pitch:this.toRadians(t)-Cesium.Math.PI_OVER_TWO,heading:this.toRadians(i),roll:void 0};r.setView({destination:u,orientation:m});var l=40075016.68557849/(512*Math.pow(2,n)),p=this.computeDistanceForResolution(s,1,l,this.toRadians(o));r.moveBackward(p),this.viewer.render()},computeDistanceForResolution:function(e,t,i,n){var a=e.canvas,o=e.camera.frustum.fovy;return i*a.clientHeight*t*Math.cos(Math.abs(n))/2/Math.tan(o/2)},computeResolutionForDistance:function(e,t,i,n){var a=e.canvas,o=e.camera.frustum.fovy;return 2*i*Math.tan(o/2)/t/Math.cos(Math.abs(n))/a.clientHeight},pickOnTerrainOrEllipsoid:function(e,t){var i=e.camera.getPickRay(t);return e.globe.pick(i,e)||e.camera.pickEllipsoid(t)},pickCenterPoint:function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return this.pickOnTerrainOrEllipsoid(e,i)}},s.prototype={update:function(){null!=this.control&&this.control.isAutoSwitch&&this.control.sceneMode==t.Scene3D&&(this.camera.computeZoom()>=this.control.switchZoom&&this.control.switchTo(t.Scene2D))},show:function(e){this.camera.viewer.useDefaultRenderLoop=e,this.getElement(this.container).style.visibility=e?"visible":"hidden"},getElement:function(e){if("string"==typeof e){var t=document.getElementById(e);if(null===t)throw new Error;e=t}return e}},r.prototype={toDegrees:function(e){return e*(180/Math.PI)},toRadians:function(e){return e*(Math.PI/180)},computeZoom:function(){return this.computeParam().zoom},computeParam:function(){var e={},t=this.viewer.scene,i=t.camera,n=Cesium.Ellipsoid.WGS84,a=this.pickCenterPoint(t);if(!a){var o=i.positionCartographic.clone();o.height=t.globe.getHeight(o)||0,a=Cesium.Ellipsoid.WGS84.cartographicToCartesian(o)}e.carto=Cesium.Ellipsoid.WGS84.cartesianToCartographic(a),e.longitude=this.toDegrees(e.carto.longitude),e.latitude=this.toDegrees(e.carto.latitude);var s=Cesium.Cartesian3.distance(a,i.position);e.resolution=this.computeResolutionForDistance(t,1,s,this.toRadians(e.latitude));var r=40075016.68557849/e.resolution/512;if(e.zoom=Math.log(r)/Math.LN2,a){var c=i.position,h=new Cesium.Cartesian3;n.geocentricSurfaceNormal(a,h);var u=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(c,a,u),Cesium.Cartesian3.normalize(u,u);var m=i.up,l=i.right,p=new Cesium.Cartesian3(-a.y,a.x,0);e.heading=Cesium.Cartesian3.angleBetween(l,p);var d=Cesium.Cartesian3.cross(a,m,new Cesium.Cartesian3).z;e.heading=d<0?e.heading:-e.heading;var g=Math.acos(Cesium.Cartesian3.dot(h,u));e.pitch=isNaN(g)?0:g}else e.heading=i.heading,e.pitch=-i.pitch+Math.PI/2;return e},switchTo:function(e){var t=e.pitch,i=e.heading,n=e.zoom,a=e.longitude,o=e.latitude,s=this.viewer.scene,r=s.camera,c=(Cesium.Ellipsoid.WGS84,new Cesium.Cartographic(this.toRadians(a),this.toRadians(o)));if(s.globe){var h=s.globe.getHeight(c);c.height=h||0}var u=Cesium.Ellipsoid.WGS84.cartographicToCartesian(c),m={pitch:this.toRadians(t)-Cesium.Math.PI_OVER_TWO,heading:this.toRadians(i),roll:void 0};r.setView({destination:u,orientation:m});var l=40075016.68557849/(512*Math.pow(2,n)),p=this.computeDistanceForResolution(s,1,l,this.toRadians(o));r.moveBackward(p),this.viewer.render()},computeDistanceForResolution:function(e,t,i,n){var a=e.canvas,o=e.camera.frustum.fovy;return i*a.clientHeight*t*Math.cos(Math.abs(n))/2/Math.tan(o/2)},computeResolutionForDistance:function(e,t,i,n){var a=e.canvas,o=e.camera.frustum.fovy;return 2*i*Math.tan(o/2)/t/Math.cos(Math.abs(n))/a.clientHeight},pickOnTerrainOrEllipsoid:function(e,t){var i=e.camera.getPickRay(t);return e.globe.pick(i,e)||e.camera.pickEllipsoid(t)},pickCenterPoint:function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return this.pickOnTerrainOrEllipsoid(e,i)}},c.prototype={switchTo:function(e){if(e==t.Scene2D){this.scene3D.show(!1),this.scene2D.show(!0);var i=this.scene3D.camera.computeParam();this.scene2D.camera.switchTo(i)}else if(e==t.Scene3D){this.scene3D.show(!0),this.scene2D.show(!1);i=this.scene2D.camera.computeParam();this.scene3D.camera.switchTo(i)}this.sceneMode=e}},e.SceneMode=t,e.MapboxScene=n,e.MapboxCamera=a,e.CesiumScene=s,e.CesiumCamera=r,e.SceneControl=c,e.REVISION="100dev",Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=globemap.js.map
